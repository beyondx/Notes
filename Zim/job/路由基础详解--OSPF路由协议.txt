Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2012-09-03T20:32:02+08:00

====== 路由基础详解--OSPF路由协议 ======
Created Monday 03 September 2012
http://net.zdnet.com.cn/network_security_zone/2010/0813/1847831.shtml

本文主要给大家讲述了路由器使用时常用到的一种网络协议--OSPF协议，并且针对它的特性特点，给出了具体的介绍，希望看过此文之后能对你有所帮助。

鉴于早期__距离矢量协议__所造成的诸多网络问题，网络设计者又开发了更新、更先进的路由协议——__链路状态路由协议__。OSPF路由协议就是一种链路状态路由协议。随着Internet技术在全球范围的飞速发展，OSPF已成为目前Internet广域网和Intranet企业网采用最多、应用最广泛的路由协议之一。作为一种链路状态的路由协议，OSPF将__链路状态广播数据包LSA（Link State Advertisement）__传送给在某一区域内的__所有__路由器，这一点与距离矢量路由协议不同。运行距离矢量路由协议的路由器是将部分或全部的路由表传递给与其相邻的路由器。

OSPF路由协议也是一种IGP协议，它只能在工作在自治域系统内部，不能跨自治域系统工作。对比距离矢量路由协议，OSPF路由协议具有__快速收敛__与适用范围更广的优势。

在大型的网络拓扑结构中，如果每台路由器都将自己学到的整个网络的路由信息传送更新的话，将会严重地占用带宽资源，对于像荣新外企IT培训中心这样以传输音频、视频为主的数据时，更会出现音频、视频传输的不流畅。而OSPF路由协议很好地解决了这些问题。在刚刚开始工作的时候，首先和相邻的路由器建立__邻居关系__，形成邻居表，然后互相交换自己所了解的网络拓扑。路由器在没有学习到全部网络拓扑是__不会进行任何路由操作__的，因为这时候的路由表是空的。只有当路由器学到了__全部__的网络拓扑，建立了__拓扑表（也称链路状态数据库）__之后，他们会使用__最短路径优先（SPF）__算法，从拓扑表中计算出最佳路由。因为，所有运行OSPF路由协议的路由器都维护着相同的拓扑表，路由器可以自己从中计算路由。

在运行OSPF路由协议的网络里，当网络拓扑发生了变化，例如，一条物理线路出现了故障。发现该变化的邻居路由器会向其他路由器发送__触发的路由更新包__——__链路状态更新包（LSU）__。在LSU中包含了关于发生变化的网段信息，__链路状态通告（LSA）__。接收到该更新包的路由器，会继续向其他路由器发送更新，同时根据LSA中的信息，在拓扑表里重新计算发生变化网段的路由。由于没有对链路的保持时间，OSPF路由协议的收敛速度是相当快的，这一点对于大型的网络是非常关键的。

OSPF路由协议还可以__把一个大型的网络划分区域__，这点跟IS-IS相似，不同的是在OSPF中会有一个__唯一的骨干区域__。这样对于**路由信息的汇总**起了很好的作用，对于设备的采用也可以根据其所在区域的位置选择不同成本的设备，对工程成本有了很好的规划。这种特性也使OSPF路由协议能够在大规模的路由网络中正常高效地工作。

1．链路

将运行OSPF路由协议的路由器所连接的网络线路称为链路。

路由器会检查其所连接的网络状态，然后将该信息由自己的所有接口向邻居传送，这个过程称为“泛洪（Flooding）”。运行OSPF路由协议的路由器，由邻居处得到关于链路的信息，并且将该信息继续向其他邻居传送。

2．链路状态

链路的工作状态，是正常工作，还是发生故障，这些相关的信息称为链路状态。

在OSPF中，只需要发送链路状态信息就可以确保对网络的掌握。也是通过这种信息来交换学习路由信息。

3．区域

OSPF路由协议会把大规模的网络划分成多个小范围的区域，以避免大规模网络所带来的弊病，从而提高网络性能。OSPF中区域的划分是非常重要的内容，很多公司的面试题都会涉及到这个方面，后面会具体了解OSPF。

4．邻居

在同样运行OSPF路由协议的两台路由器__物理直连__时，就可以成为邻居关系。只有成为了邻居关系它们互相才能交换路由信息。当线路出现问题时，可以通过查看邻居状态来排除故障。

5．链路开销

OSPF路由协议通过计算链路的带宽来计算最佳路径的选择。每条链路根据带宽不同会有不同的度量值，这个度量值在OSPF路由协议中称作__“开销（Cost）”__。

10Mbps的以太网的链路开销是10，16Mbps令牌环网的链路开销是6，FDDI或快速以太网的开销是1，2M串行链路的开销是48，56KB串行线路的开销为1785。

路由器将整条路径的开销相加，所得之和最小的值为最佳路径。

6．邻居表

与EIGRP、IS-IS一样，OSPF路由协议也需要维系**3张表**。__最基础的就是邻居表__。

凡是与路由器同在OSPF路由协议中并且物理直连的路由器都会被收录在该表中，只有形成了邻居表，路由器才可能向其他的路由器学习拓扑结构。

7．拓扑表

当路由器建立了邻居表之后，运行OSPF路由协议的路由器会__互相通告自己所了解的网络拓扑建立拓扑表__。在一个区域里，所有的路由器应该形成**相同**的拓扑表。只有建立了拓扑表之后，路由器才能使用SPF算法从拓扑表里计算路由。

8．路由表

路由器依靠路由表来为数据包进行路由操作。在运行OSPF路由协议的路由器中，当完整的拓扑表建立起来之后，路由器便会按照链路带宽的不同，使用SPF算法从拓扑表例计算出路由，记入__路由表__。

9．路由器标识（Route ID）

路由器标识不是为路由器起的名称，而是路由器在OSPF路由协议操作中对自己的标识。一般来说，在没有配置回环接口（Loopback Interface：一种路由器上的虚拟接口，它是逻辑存在的，路由器上并没有这种物理接口，它是永久开启的。）时，路由器的所有物理接口上配置的__最大IP地址__就是这台路由器的标识。如果在路由器上配置了回环地址接口，则不论回环地址上的IP地址是多少，该地址都自动成为路由器的标识。当在路由器上配置了多个回环接口时，这些回环接口中最大的IP地址将作为路由器的标识。

在实际工程中，可能会遇到没有设置Route ID的情况，由路由器默认的最大物理接口地址为Route ID，而这个接口并没有连接任何设备，也就是Shut Down状态，在这时不管这台路由器的其他接口状态如何，OSPF都将随着Route ID的Shut Down而不启动。所以，在设置Route ID时一定要选用Loopback地址作为Route ID，因为这个地址是永久不关闭的，而且最好有完善的规划。

10．LSA与LSU

路由器对__某一条线路__的状态更新称为LSA，对__一组链路的状态__更新称为LSU，**LSU更新包里可包含多个LSA**。

11．DR与BDR

当几台路由器工作在同一网段上时，为了__减少网段中路由信息的交换数量__，OSPF路由协议定义了DR和BDR。负责__收集__网络中的链路状态通告，并将他们__集中__发给其他的路由器。BDR实际上是DR的备份，在DR本身没有问题时，BDR并不工作，一旦DR出现了问题BDR就会接替DR的工作。在实际工程中，DR与BDR的概念应用并不广泛。
